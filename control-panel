(async function(){
  const API_BASE = "https://ghle-theme-builder.vercel.app/api";
  const agencyCompanyId = window.agencyCompanyId; // must be set in GHL context

  if(!agencyCompanyId) return console.error("Agency Company ID missing");

  try {
    const res = await fetch(`${API_BASE}/subaccount/agency/${agencyCompanyId}`);
    const data = await res.json();

    if(!data.success) return console.error("Failed to load subaccounts");

    const container = document.createElement('div');
    container.style.padding = "20px";
    container.style.background = "#f9f9f9";
    container.style.border = "1px solid #ddd";
    container.style.borderRadius = "12px";

    data.subAccounts.forEach(sub => {
      const div = document.createElement('div');
      div.style.marginBottom = "10px";
      div.innerHTML = `
        <strong>${sub.locationName}</strong> (ID: ${sub.locationId}) <br>
        Access: ${sub.access ? '✅' : '❌'} <br>
        Theme: ${sub.themeId ? sub.themeId.name : 'None'}
      `;
      container.appendChild(div);
    });

    document.body.appendChild(container);
  } catch(e){
    console.error("Failed to fetch agency subaccounts:", e);
  }
})();
